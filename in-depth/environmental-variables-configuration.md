# Configuration

Here you can find a list of all configurable things through environmental variables in Defguard core server, YubiBridge client and Gateway client.

## Core server

### Environment files

Environment variables that are **not already set** are loaded from .env files by [`dotenvy`](https://crates.io/crates/dotenvy) crate. Default `.env` file can be overwritten by creating `.env.local` which is not tracked by git.

### LDAP configuration

* `DEFGUARD_LDAP_URL` - Your LDAP URL to read user's and group's data (e.g. `http://localhost:389`)
* `DEFGUARD_LDAP_GROUP_MEMBER_ATTR` : group attribute for members, default: `uniqueMember`
* `DEFGUARD_LDAP_GROUP_SEARCH_BASE` : group search base, default: `ou=groups,dc=example,dc=org`
* `DEFGUARD_LDAP_USER_SEARCH_BASE` : user search base, default: `dc=example,dc=org`
* `DEFGUARD_LDAP_USER_OBJ_CLASS` : user object class, default: `inetOrgPerson`
* `DEFGUARD_LDAP_GROUP_OBJ_CLASS` : group object class, default: `groupOfUniqueNames`
* `DEFGUARD_LDAP_ADMIN_GROUPNAME` : group name with administrator privileges, default: `admin`
* `DEFGUARD_LDAP_USERNAME_ATTR` : naming attribute for users, should be `cn` or `uid` , default: `cn`
* `DEFGUARD_LDAP_GROUPNAME_ATTR` : naming attribute for groups, default: `cn`
* `DEFGUARD_LDAP_MEMBER_ATTR` : naming attribute for group membership, default: `memberOf`
* `DEFGUARD_LDAP_GROUP_MEMBER_ATTR` : group attribute for members, default: `uniqueMember`

### Core configuration

* `DEFGUARD_LOG_LEVEL` - [Logger](https://crates.io/crates/log) log level, default: `info`
* `DEFGUARD_SECRET_KEY -` [Rocket](https://rocket.rs/) [_**secret\_key**_](https://api.rocket.rs/v0.4/rocket/config/struct.ConfigBuilder.html#method.secret\_key)_**.**_ Can be easily generated with\
  `openssl rand -hex 64`
* `DEFGUARD_DATABASE_URL` : Your database URL, default: `sqlite::memory`
* `DEFGUARD_HTTP_PORT` : Core server port, default: `8000`
* `DEFGUARD_AUTH_SECRET` : JWT secret key for encrypting user tokens, default: `DEFGUARD_AUTH_SECRET`
* `DEFGUARD_YUBIBRIDGE_SECRET` : JWT secret key for encrypting YubiBridge tokens, default: `DEFGUARD_YUBIBRIDGE_SECRET`
* `DEFGUARD_GATEWAY_SECRET` : JWT secret key for encrypting Gateway tokens, default: `DEFGUARD_GATEWAY_SECRET`
* DEFGUARD\_SECRET\_KEY: JWT secret key for encrypting private cookies; must be at least 64 characters long
* `DEFGUARD_WG_SERVICE_URL` : WireGuard service instance to connect to, default: `http://wireguard:50051`
* `DEFGUARD_URL` : URL of your server instance, default `localhost:8000`, Needed for OpenID discovery endpoint to work correctly.
* `DEFGUARD_WEBAUTHN_RP_ID` (optional): Relying on party ID and relying on party origin for WebAuthn used for MFA. By default, it's generated by using a base domain of `DEFGUARD_URL` (for example https://defguard.example.com is converted to defguard.example.com).



{% hint style="warning" %}
`DEFGUARD_WEBAUTHN_RP_ID`must be an effective domain of DEFGUARD\_URL (for example if hosting at `https://idm.example.com`, rp\_id must be `idm.example.com`, `example.com` or `com`). Changing `DEFGUARD_WEBAUTHN_RP_ID will potentially break all your existing Webauthn credentials.`
{% endhint %}

* `DEFGUARD_OPENID_KEY` : Path to a private key file used for OAuth2/OpenID, [more here](https://defguard.gitbook.io/defguard/features/setting-up-your-instance/docker-compose#openid-rsa-setup)
* `DEFGUARD_ADMIN_GROUPNAME`: Name of the administrator group, default: `admin`
* `DEFGUARD_DEFAULT_ADMIN_PASSWORD`: Password for the default `admin` user, default: `pass123`

### gRPC configuration

* `DEFGUARD_GRPC_PORT` : gRPC server port, default `50055`
* `DEFGUARD_GRPC_CERT` (optional): path to TLS certificate file
* `DEFGUARD_GRPC_KEY`(optional): path to TLS key file
* `DEFGUARD_GRPC_URL` : external URL of your instance's gRPC server, default `http://localhost:50055`; used for generating example VPN gateway startup command in Web UI.

## YubiBridge configuration

### Environmental variables

* `LOG_LEVEL` : Log messages level, default: `INFO`, available levels: `CRITICAL`, `ERROR`, `WARNIG`, `INFO`, `DEBUG`
* `WORKER_ID` : Name of your YubiBridge displayed on Defguard website, default: `YubiBridge`
* `DEFGUARD_TOKEN` : - Secret worker token to secure gRPC communication, available on provisioners page
* `SMARTCARD_RETRIES` : Number of retries in case provisioning failed, default: `1`
* `JOB_INTERVAL` : Defines how often(seconds) YubiBridge checks Defguard for new jobs, default: `2`
* `SMARTCARD_RETRY_INTERVAL` : Defines the number of seconds between trying to provision YubiKey again, default `15`

### CLI arguments:

* `-h` , `--help` : Display help message
* `-g <URL>`, `--grpc <URL>` : Connect to gRPC server at the given URL
* `-i <ID>` , `--id <ID>` : WorkerID, default `YubiBridge`
* `-d` , `--debug` : Enable debug mode
* `-t <TMPDIR>` , `--tmpdir <TMPDIR>` : GnuPG home directory, default: `tmp`
* `-p <first_name> <last_name> <email>` , `--provision <first_name> <last_name> <email>` : Provision YubiKey with the following data
* `-w <token>` , `--worker-token <token>` : Secret worker token to secure gRPC communication, available on provisioners page
* `-c <command>` , `--command <command>` : Run command after provisioning and pass created keys as arguments

## Gateway Configuration

### Environmental variables / Arguments

If you're using docker image you can pass this value as environmental variables or on binary you can pass them as arguments

`DEFGUARD_USERSPACE` , `-u` - Use userspace wireguard implementation, useful on systems without native wireguard support

`DEFGUARD_GRPC_URL` , `-g <URL>` - Defguard server gRPC endpoint URL default is https://localhost:50055

`DEFGUARD_STATS_PERIOD` ,`-p <SECONDS>` - Defines how often (seconds) should interface statistics be sent to the Defguard server

`DEFGUARD_TOKEN` ,`-t <TOKEN>` - Token received on Defguard after completing network wizard

DEFGUARD\_GATEWAY\_NAME, --name \<NAME> - (optional) human-readable gateway name that will be displayed in Defguard webapp&#x20;

### Config file

Gateway configuration can also be read from a file by using a `--config` CLI option. Example file contents:

```toml
# This is an example config file for Defguard VPN gateway
# To use it fill in actual values for your deployment below

# Required: secret token generated by Defguard
# NOTE: must replace default with actual value
token = "<your_gateway_token>"
# Required: Defguard server gRPC endpoint URL
# NOTE: must replace default with actual value
grpc_url = "<defguard_grpc_url>"
# Optional: gateway name which will be displayed in Defguard web UI
name = "Gateway A"
# Required: use userspace Wireguard implementation (e.g. wireguard-go)
userspace = false
# Optional: path to TLS cert file
# grpc_ca = cert.pem
# Required: how often should interface stat updates be sent to Defguard server (in seconds)
stats_period = 60
# Required: name of Wireguard interface
ifname = "wg0"
# Optional: write PID to this file
# pidfile = defguard-gateway.pid
# Required: enable logging to syslog
use_syslog = false
# Required: which syslog facility to use
syslog_facility = "LOG_USER"
# Required: which socket to use for logging
syslog_socket = "/var/run/log"
```
